@model HCMPo.Models.Employee

@{
    ViewData["Title"] = "Create Employee";
}

<h2>Create Employee</h2>

<div class="card">
    <div class="card-body">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label asp-for="FirstName" class="form-label"></label>
                        <input asp-for="FirstName" class="form-control" />
                        <span asp-validation-for="FirstName" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label asp-for="LastName" class="form-label"></label>
                        <input asp-for="LastName" class="form-control" />
                        <span asp-validation-for="LastName" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label asp-for="BadgeNumber" class="form-label"></label>
                        <input asp-for="BadgeNumber" class="form-control" />
                        <span asp-validation-for="BadgeNumber" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="Email" class="form-label"></label>
                        <input asp-for="Email" class="form-control" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="PhoneNumber" class="form-label"></label>
                        <input asp-for="PhoneNumber" class="form-control" />
                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="DepartmentId" class="form-label">Department</label>
                        <select asp-for="DepartmentId" class="form-select" asp-items="ViewBag.DepartmentId">
                            <option value="">-- Select Department --</option>
                        </select>
                        <span asp-validation-for="DepartmentId" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="JobTitleId" class="form-label">Job Title</label>
                        <select asp-for="JobTitleId" class="form-select" asp-items="ViewBag.JobTitleId">
                            <option value="">-- Select Job Title --</option>
                        </select>
                        <span asp-validation-for="JobTitleId" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="DateOfBirth" class="form-label"></label>
                        <input asp-for="DateOfBirth" class="form-control" type="date" />
                        <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="EmploymentDate" class="form-label"></label>
                        <input asp-for="EmploymentDate" class="form-control" type="date" />
                        <span asp-validation-for="EmploymentDate" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="BasicSalary" class="form-label">Gross Salary</label>
                        <input id="grossSalary" name="BasicSalary" class="form-control" type="number" step="0.01" required />
                        <span asp-validation-for="BasicSalary" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="netSalary" class="form-label">Net Salary</label>
                        <input id="netSalary" name="Salary" class="form-control" type="number" step="0.01" readonly />
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Select Taxes</label><br />
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="incomeTax" name="taxes" value="IncomeTax" checked>
                    <label class="form-check-label" for="incomeTax">Income Tax</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="pension" name="taxes" value="Pension" checked>
                    <label class="form-check-label" for="pension">Pension</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input tax-checkbox" type="checkbox" id="otherTax" name="taxes" value="Other" />
                    <label class="form-check-label" for="otherTax">Other</label>
                    <select id="otherTaxDropdown" class="form-select d-inline-block ms-2" style="width:auto; display:inline-block; min-width:150px;">
                        <option value="">-- Select --</option>
                        @foreach (var other in ViewBag.OtherTaxes)
                        {
                            <option value="@other.Name" data-percent="@other.Percentage">@other.Name (@other.Percentage%)</option>
                        }
                    </select>
                    <input type="number" class="form-control d-inline-block ms-2 tax-percentage" id="otherTaxPercent" name="taxPercent_Other" min="0" max="100" step="0.01" style="width:100px;" placeholder="%" readonly />
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="Address" class="form-label"></label>
                        <textarea asp-for="Address" class="form-control" rows="3"></textarea>
                        <span asp-validation-for="Address" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label asp-for="Status" class="form-label"></label>
                <select asp-for="Status" class="form-select" asp-items="Html.GetEnumSelectList<HCMPo.Models.EmploymentStatus>()">
                    <option value="">-- Select Status --</option>
                </select>
                <span asp-validation-for="Status" class="text-danger"></span>
            </div>

            <div class="mt-3">
                <button type="submit" class="btn btn-primary">Create</button>
                <a asp-action="Index" class="btn btn-secondary">Back to List</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
    <script>
        var incomeTaxBrackets = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.IncomeTaxBrackets ?? new List<HCMPo.Models.TaxSetting>()));
        var pension = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.Pension));
        function getIncomeTaxPercent(gross) {
            for (var i = 0; i < incomeTaxBrackets.length; i++) {
                var b = incomeTaxBrackets[i];
                if (gross >= b.MinSalary && gross <= b.MaxSalary) return b.Percentage;
            }
            return 0;
        }
        function updateTaxesAndNetSalary() {
            var gross = parseFloat(document.getElementById('grossSalary').value) || 0;
            // Income Tax
            var incomeTaxPercent = getIncomeTaxPercent(gross);
            document.getElementById('incomeTaxPercent').value = incomeTaxPercent;
            document.getElementById('incomeTaxPercent').disabled = true;
            // Pension
            var pensionPercent = pension ? pension.Percentage : 0;
            document.getElementById('pensionPercent').value = pensionPercent;
            document.getElementById('pensionPercent').disabled = true;
            // Other
            var otherPercent = 0;
            var otherDropdown = document.getElementById('otherTaxDropdown');
            if (otherDropdown && otherDropdown.value) {
                var selected = otherDropdown.options[otherDropdown.selectedIndex];
                otherPercent = parseFloat(selected.getAttribute('data-percent')) || 0;
            }
            document.getElementById('otherTaxPercent').value = otherPercent;
            document.getElementById('otherTaxPercent').disabled = true;
            // Calculate net
            var totalTax = 0;
            if (document.getElementById('incomeTax').checked) totalTax += incomeTaxPercent;
            if (document.getElementById('pension').checked) totalTax += pensionPercent;
            if (document.getElementById('otherTax').checked) totalTax += otherPercent;
            var net = gross - (gross * totalTax / 100);
            document.getElementById('netSalary').value = net.toFixed(2);
        }
        document.getElementById('grossSalary').addEventListener('input', updateTaxesAndNetSalary);
        document.getElementById('incomeTax').addEventListener('change', updateTaxesAndNetSalary);
        document.getElementById('pension').addEventListener('change', updateTaxesAndNetSalary);
        document.getElementById('otherTax').addEventListener('change', updateTaxesAndNetSalary);
        document.getElementById('otherTaxDropdown').addEventListener('change', updateTaxesAndNetSalary);
        updateTaxesAndNetSalary();
    </script>
} 